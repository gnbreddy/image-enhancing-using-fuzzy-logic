<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuzzy Logic Contrast Enhancer</title>
    <!-- Simple favicon to prevent 404 errors -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üñºÔ∏è</text></svg>">
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        canvas {
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            max-width: 100%;
            height: auto;
            background-color: #fff;
        }
        .slider-container {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 0.5rem;
            padding: 1rem;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-2xl shadow-xl max-w-5xl w-full">
        <div class="flex items-center justify-between mb-6">
            <button onclick="window.location.href='index.html'" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300">
                ‚Üê Back to Home
            </button>
            <h1 class="text-3xl font-bold text-gray-800">Fuzzy Logic Contrast Enhancer</h1>
            <div class="w-32"></div> <!-- Spacer for centering -->
        </div>
        
        <div class="space-y-4 mb-6">
            <div class="flex flex-col items-center">
                <label for="image-upload" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg cursor-pointer transition-colors duration-300">
                    Upload Image
                </label>
                <input type="file" id="image-upload" accept="image/*" class="hidden">
                <p id="file-name" class="mt-2 text-gray-600 text-sm"></p>
            </div>
            
            <!-- Contrast Enhancement Parameters -->
            <div class="grid md:grid-cols-3 gap-4">
                <div class="slider-container">
                    <label for="enhancement-strength" class="block text-sm font-medium mb-2">Enhancement Strength: <span id="strength-value">0.5</span></label>
                    <input type="range" id="enhancement-strength" min="0.1" max="2.0" step="0.1" value="0.5" class="w-full">
                </div>
                <div class="slider-container">
                    <label for="dark-threshold" class="block text-sm font-medium mb-2">Dark Threshold: <span id="dark-value">80</span></label>
                    <input type="range" id="dark-threshold" min="0" max="255" value="80" class="w-full">
                </div>
                <div class="slider-container">
                    <label for="bright-threshold" class="block text-sm font-medium mb-2">Bright Threshold: <span id="bright-value">175</span></label>
                    <input type="range" id="bright-threshold" min="0" max="255" value="175" class="w-full">
                </div>
            </div>
            
            <button id="process-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 shadow-lg" disabled>
                Enhance Contrast
            </button>
        </div>

        <div id="loading-indicator" class="hidden text-center text-gray-500 mb-4">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
            <p class="mt-2">Processing image...</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
            <div class="flex flex-col items-center">
                <h2 class="text-xl font-semibold mb-2">Original Image</h2>
                <canvas id="original-canvas"></canvas>
            </div>
            <div class="flex flex-col items-center">
                <h2 class="text-xl font-semibold mb-2">Enhanced Image</h2>
                <canvas id="processed-canvas"></canvas>
            </div>
        </div>
        
        <!-- Download Section -->
        <div id="download-section" class="hidden mt-8 text-center">
            <button id="download-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 shadow-lg">
                üì• Download Enhanced Image
            </button>
            <p class="mt-2 text-gray-600 text-sm">Download your contrast-enhanced image</p>
        </div>

        <div class="mt-6 bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold text-blue-800 mb-2">How it works:</h3>
            <p class="text-blue-700 text-sm">
                This fuzzy logic system classifies pixels into Dark, Medium, and Bright regions using triangular 
                and trapezoidal membership functions. It then applies adaptive contrast enhancement based on the 
                fuzzy classification, preserving details while improving overall image quality.
            </p>
        </div>
    </div>

    <script>
        // Get references to all the DOM elements
        const imageUpload = document.getElementById('image-upload');
        const fileNameDisplay = document.getElementById('file-name');
        const processBtn = document.getElementById('process-btn');
        const originalCanvas = document.getElementById('original-canvas');
        const processedCanvas = document.getElementById('processed-canvas');
        const loadingIndicator = document.getElementById('loading-indicator');
        const enhancementStrength = document.getElementById('enhancement-strength');
        const darkThreshold = document.getElementById('dark-threshold');
        const brightThreshold = document.getElementById('bright-threshold');
        const strengthValue = document.getElementById('strength-value');
        const darkValue = document.getElementById('dark-value');
        const brightValue = document.getElementById('bright-value');
        
        const originalCtx = originalCanvas.getContext('2d');
        const processedCtx = processedCanvas.getContext('2d');
        
        let originalImage = null;

        // Update slider values display
        enhancementStrength.addEventListener('input', (e) => {
            strengthValue.textContent = e.target.value;
        });

        darkThreshold.addEventListener('input', (e) => {
            darkValue.textContent = e.target.value;
        });

        brightThreshold.addEventListener('input', (e) => {
            brightValue.textContent = e.target.value;
        });

        // Event listener for the file input
        imageUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                fileNameDisplay.textContent = file.name;
                processBtn.disabled = true;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        // Set canvas sizes to match the image
                        originalCanvas.width = originalImage.width;
                        originalCanvas.height = originalImage.height;
                        processedCanvas.width = originalImage.width;
                        processedCanvas.height = originalImage.height;
                        
                        // Draw the original image on the canvas
                        originalCtx.drawImage(originalImage, 0, 0);
                        processedCtx.clearRect(0, 0, processedCanvas.width, processedCanvas.height);
                        processBtn.disabled = false;
                    };
                    originalImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Event listener for the process button
        processBtn.addEventListener('click', () => {
            if (originalImage) {
                loadingIndicator.classList.remove('hidden');
                processBtn.disabled = true;
                
                // Use a small delay to allow the loading message to appear
                setTimeout(() => {
                    processImage();
                    loadingIndicator.classList.add('hidden');
                    processBtn.disabled = false;
                }, 100);
            }
        });

        // Event listener for the download button
        document.getElementById('download-btn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'contrast_enhanced_image.png';
            link.href = processedCanvas.toDataURL();
            link.click();
        });

        /**
         * Main function to process the image using fuzzy logic contrast enhancement.
         */
        function processImage() {
            const imageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);
            const data = imageData.data;
            const width = originalCanvas.width;
            const height = originalCanvas.height;
            const processedData = new Uint8ClampedArray(data);
            
            const strength = parseFloat(enhancementStrength.value);
            const darkThresh = parseInt(darkThreshold.value);
            const brightThresh = parseInt(brightThreshold.value);
            
            // Process each pixel
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const idx = (y * width + x) * 4;
                    
                    // Get RGB values
                    const r = data[idx];
                    const g = data[idx + 1];
                    const b = data[idx + 2];
                    
                    // Calculate grayscale value for classification
                    const gray = (r + g + b) / 3;
                    
                    // Apply fuzzy logic contrast enhancement
                    const enhanced = fuzzyContrastEnhancement(r, g, b, gray, darkThresh, brightThresh, strength);
                    
                    // Apply the enhanced values
                    processedData[idx] = enhanced.r;
                    processedData[idx + 1] = enhanced.g;
                    processedData[idx + 2] = enhanced.b;
                    // Alpha channel remains unchanged
                }
            }
            
            // Create new ImageData and draw it
            const newImageData = new ImageData(processedData, width, height);
            processedCtx.putImageData(newImageData, 0, 0);
            
            // Show download section
            document.getElementById('download-section').classList.remove('hidden');
        }

        /**
         * Apply fuzzy logic contrast enhancement to a pixel.
         */
        function fuzzyContrastEnhancement(r, g, b, gray, darkThresh, brightThresh, strength) {
            // Fuzzy classification of pixel brightness
            const darkMembership = triangularMembership(gray, 0, darkThresh * 0.5, darkThresh);
            const mediumMembership = trapezoidalMembership(gray, darkThresh * 0.7, darkThresh, brightThresh, brightThresh * 1.3);
            const brightMembership = triangularMembership(gray, brightThresh, brightThresh * 1.2, 255);
            
            // Calculate enhancement factors based on fuzzy membership
            const darkEnhancement = darkMembership * strength * 1.5; // Strong enhancement for dark areas
            const mediumEnhancement = mediumMembership * strength * 0.8; // Moderate enhancement for medium areas
            const brightEnhancement = brightMembership * strength * 1.2; // Good enhancement for bright areas
            
            const totalEnhancement = darkEnhancement + mediumEnhancement + brightEnhancement;
            
            // Apply contrast enhancement using adaptive histogram equalization
            const enhancedR = applyContrastEnhancement(r, totalEnhancement);
            const enhancedG = applyContrastEnhancement(g, totalEnhancement);
            const enhancedB = applyContrastEnhancement(b, totalEnhancement);
            
            return {
                r: Math.min(255, Math.max(0, Math.round(enhancedR))),
                g: Math.min(255, Math.max(0, Math.round(enhancedG))),
                b: Math.min(255, Math.max(0, Math.round(enhancedB)))
            };
        }

        /**
         * Apply contrast enhancement to a single color channel.
         */
        function applyContrastEnhancement(value, enhancement) {
            // Normalize to 0-1 range
            const normalized = value / 255;
            
            // Apply adaptive enhancement
            let enhanced;
            if (normalized < 0.5) {
                // Dark regions: apply stronger enhancement
                enhanced = Math.pow(normalized, 1 - enhancement);
            } else {
                // Bright regions: apply moderate enhancement
                enhanced = Math.pow(normalized, 1 - enhancement * 0.5);
            }
            
            // Convert back to 0-255 range
            return enhanced * 255;
        }

        /**
         * Triangular membership function.
         */
        function triangularMembership(x, a, m, b) {
            if (x <= a || x >= b) {
                return 0;
            } else if (x >= a && x <= m) {
                return (x - a) / (m - a);
            } else if (x >= m && x <= b) {
                return (b - x) / (b - m);
            }
            return 0;
        }

        /**
         * Trapezoidal membership function.
         */
        function trapezoidalMembership(x, a, m1, m2, b) {
            if (x <= a || x >= b) {
                return 0;
            } else if (x >= m1 && x <= m2) {
                return 1;
            } else if (x > a && x < m1) {
                return (x - a) / (m1 - a);
            } else if (x > m2 && x < b) {
                return (b - x) / (b - m2);
            }
            return 0;
        }
    </script>
</body>
</html>
